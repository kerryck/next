<!DOCTYPE html>
<html>
  <head>
    <script>
      var urlMatcher = /\d+/g;
      
      var matches = {};
      // Called when the url of a tab changes.
      var checkForValidUrl = function(tabId, changeInfo, tab) {
        var match = tab.url.match(urlMatcher);
        console.log(tabId, tab.url, match);
        
        if (match !== null ) {
          matches[tabId] = match.pop()
          chrome.pageAction.show(tabId);
          chrome.tabs.executeScript(null, {file: "contentscript.js"});
        } else {
          delete matches[tabId];
          chrome.pageAction.hide(tabId);
        }
      };

      chrome.extension.onRequest.addListener(function(message, source){
        if(message.changePage === true){
          var tabId = source.tab.id;
          var next = parseInt(matches[tabId], 10);
          var newUrl = source.tab.url.replace(matches[tabId], 
                                               next + message.changeAmmount);
        
          chrome.tabs.update(source.tab.id, {url: newUrl})
        }
      });
      // Listen for any changes to the URL of any tab.
      chrome.tabs.onUpdated.addListener(checkForValidUrl);
    </script>
  </head>
</html>

<!--

{"favIconUrl":"https://developer.mozilla.org/favicon.ico","id":26,"incognito":false,"index":6,"pinned":false,"selected":true,"status":"complete","title":"test - MDC Docs","url":"https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/RegExp/test","windowId":1}

-->
